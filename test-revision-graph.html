<!doctype html>
<html>
  <head>
    <title>Test Revision Graph</title>
  </head>
  <body>
    <script>
      const mockRevisions = [
        {
          id: 'rev-1',
          page_id: 'page-1',
          revision_hash: 'abc12345',
          parent_revision_id: undefined,
          title: 'Test Page',
          slug: 'test-page',
          status: 'published',
          created_at: Math.floor(Date.now() / 1000) - 3600,
          is_published: true,
          children: [],
          depth: 0,
          branch: 0
        },
        {
          id: 'rev-2',
          page_id: 'page-1',
          revision_hash: 'def67890',
          parent_revision_id: 'rev-1',
          title: 'Test Page',
          slug: 'test-page',
          status: 'draft',
          created_at: Math.floor(Date.now() / 1000) - 1800,
          is_published: false,
          children: [],
          depth: 1,
          branch: 0
        },
        {
          id: 'rev-3',
          page_id: 'page-1',
          revision_hash: 'ghi11111',
          parent_revision_id: 'rev-2',
          title: 'Test Page',
          slug: 'test-page',
          status: 'draft',
          created_at: Math.floor(Date.now() / 1000),
          is_published: false,
          children: [],
          depth: 2,
          branch: 0
        }
      ];

      const LEVEL_HEIGHT = 80;
      const depthMap = new Map();
      let maxDepth = 0;

      mockRevisions.forEach((rev) => {
        const depth = rev.depth || 0;
        maxDepth = Math.max(maxDepth, depth);

        if (!depthMap.has(depth)) {
          depthMap.set(depth, []);
        }
        depthMap.get(depth).push(rev);
      });

      console.log('Max depth:', maxDepth);
      console.log('Depth map:', depthMap);

      const treeNodes = [];

      for (let depth = 0; depth <= maxDepth; depth++) {
        const nodesAtDepth = depthMap.get(depth) || [];
        console.log(`Nodes at depth ${depth}:`, nodesAtDepth.length);

        nodesAtDepth.sort((a, b) => {
          if (a.branch !== b.branch) return a.branch - b.branch;
          return a.created_at - b.created_at;
        });

        nodesAtDepth.forEach((rev) => {
          const branchOffset = rev.branch * 25;
          const x = 30 + branchOffset;
          const y = 20 + depth * LEVEL_HEIGHT;

          treeNodes.push({
            revision: rev,
            level: depth,
            column: rev.branch,
            x,
            y
          });
        });
      }

      console.log('Tree nodes:', treeNodes);
      console.log('Number of tree nodes:', treeNodes.length);
    </script>
  </body>
</html>
