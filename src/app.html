<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%sveltekit.assets%/favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script>
      // Prevent FOUC (Flash of Unstyled Content) by setting theme immediately
      // This runs before any framework code, ensuring the correct theme is applied
      (function () {
        try {
          const THEME_KEY = 'theme';
          const stored = localStorage.getItem(THEME_KEY);
          const sessionTheme = sessionStorage.getItem('applied-theme');

          // Use session theme if available for fastest retrieval
          if (sessionTheme && ['light', 'dark'].includes(sessionTheme)) {
            document.documentElement.setAttribute('data-theme', sessionTheme);
            document.documentElement.classList.add('theme-loaded');
            return;
          }

          // Validate stored value
          const validThemes = ['light', 'dark', 'system'];
          const isValid = stored && validThemes.includes(stored);
          const theme = isValid ? stored : 'system';

          // Determine actual theme to apply
          let actualTheme = theme;
          if (theme === 'system') {
            try {
              const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
              actualTheme = prefersDark ? 'dark' : 'light';
            } catch (e) {
              // Fallback to light if matchMedia fails
              actualTheme = 'light';
            }
          }

          // Apply theme immediately
          document.documentElement.setAttribute('data-theme', actualTheme);
          document.documentElement.classList.add('theme-loaded');

          // Store in sessionStorage for faster retrieval on subsequent page loads
          sessionStorage.setItem('applied-theme', actualTheme);
        } catch (e) {
          // Fail silently and let CSS defaults handle theme
          console.warn('Failed to initialize theme:', e);
          document.documentElement.setAttribute('data-theme', 'light');
          document.documentElement.classList.add('theme-loaded');
        }
      })();
    </script>
    %sveltekit.head%
  </head>
  <body data-sveltekit-preload-data="hover">
    <div style="display: contents">%sveltekit.body%</div>
  </body>
</html>
